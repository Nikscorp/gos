# 24. Временные автоматы как формальные модели распределенных систем реального времени. Вычисления временных автоматов. Примеры использования временных автоматов для моделирования встроенных систем. Зеноновские вычисления. Синтаксис и семантика TimedCTL. Задача верификации моделей программ реального времени. Программно-инструментальное средство верификации моделей программ реального времени UPPAAL.

**Система реального времени** (СРВ) — это система, поведение которой существенно зависит не только от того, в каком порядке изменяются состояния компонентов системы, но и от того, за какое время происходит изменение состояний.

**Элементарными временными ограничениями** над множеством часов $C$ называются выражения вида: true,  $x < k$,  $x \le k$,  $x-y < k$, $x-y \le k$, где $x,y \in C$, $k \in N_0$ 

$ETC(C)$ — множество всех элементарных временных ограничений над $C$

Синтаксис **временных ограничений** над $C$ задаётся формой Бэкуса-Наура
$g ::= ~ (etc) ~ | ~ (g \& g) ~ | ~ (\neg g)$, где $g$ — временное ограничение и $etc \in ETC(C)$

$TC(C)$ — множество всех временных ограничений над $C$

Временное ограничение **инвариантно**, если в нём не содержатся подвыражения $x − y < k$, $x − y ≤ k$ и связка $\neg$

$IC(C)$ — множество всех инвариантных временныx ограничений над $C$



**Оценкой часов** множества $C$ называется отображение вида $v: C \to R_{\ge0}$

**Выполнимость временного ограничения** $tc$  на оценке часов $v$ ($v \models tc$) определяется следующим образом ($\bowtie - <, \le$):

* $v \models true$
* $v \models x \bowtie k$   $\Leftrightarrow$   $v(x) \bowtie $ k
* $v \models x-y \bowtie k$   $\Leftrightarrow$   $v(x) - v(y) \bowtie k$ 
* $v \models tc_1 \& tc_2$ $\Leftrightarrow$ $v \models tc_1$  и $v \models tc_2$ 
* $v \models \neg tc_1$  $\Leftrightarrow$ $v \nvDash tc_1$



**Временной автомат** над множеством атомарных высказываний AP — это система $(L, l_0,\xi, C, I, T)$, где 
$L$— конечное множество состояний 
$l_0$ — начальное состояние $l_0 \in L$, 
$\xi: L \to 2^{AP}$ — разметка состояний событиями
$C$  — конечное множество часов 
$I : L\to IC(C)$  — разметка состояний инвариантами 
$T \sube L \times TC(C) \times 2^{C} \times L$ отношение переходов — $(l_i, g,X,l_2)$   — переход из состояния $l_1$  в состояние $l_2$  с предусловием $g$ и множеством сбрасываемых часов $X$  [$l_1 \to^{g,X} l_2$]

 

**Вычислительная конфигурация** временного автомата  $A =(L, l_0,\xi, C, I, T)$ имеет вид $\sigma = (l,v)$ , где $l \in L$ и $v : C \to R_{\ge0}$  ($v$ - это оценка часов)

Конфигурации (дискретно) преобразуются автоматом $A$ в процессе вычисления двумя способами:

1. Продвижение времени ($\sigma \mapsto \sigma′$ )   [$d \in R_{\ge0}$]

   1.    $\sigma' = \sigma + d $  
   2.  $v +d \models I(l)$  - новая оценка часов удовлетворяет ограничениям состояния $l$ при изменении времени

2. Выполнение перехода ($\sigma \hookrightarrow \sigma′$ ) [$l \to^{g,X} l' \in T$]

   1. $\sigma' = \sigma[X][l/l']$  сброс часов
   2. $v \models g$ оценка часов удовлетворяет ограничению перехода
   3. $v[X] \models I(l')$ в новом состоянии выполняются оценки часов 

   

**Трассой** автомата, исходящей из конфигурации $\sigma$ (или, коротко, $\sigma$-трассой), называется последовательность конфигураций вида  $\sigma  \to \sigma_1 \to \sigma_2 \to ...$

**Частичным вычислением автомата** называется трасса,  исходящая из начальной конфигурации.

Конфигурация $\sigma$ называется **тупиковой**, если не существует конфигурации $σ′$, такой что $\sigma \to \sigma'$ .

Трасса называется **полной**, если она бесконечна или оканчивается тупиковой конфигурацией. 

**Вычислением** автомата называется полная трасса, исходящая из начальной конфигурации. 



**Примеры использования**:

- Оценка времени реакции встроенной системы на определенное событие (Например после возникновения ошибки в системе должна загореться сигнальная лампочка в течение 3 секунд, и переключится в режим обработки ошибки в течение 10 секунд)
- Проверка свойств взаимодействия (Например, что в системе управления транспортом невозможна такая ситуация, что светофоры горят зеленым для пересекающихся дорог)



Полная трасса конвергентна, если её длительность конечна, и дивергентна, если её длительность бесконечна. Вычислением Зенона (или **зеноновским вычислением**) называется конвергентное вычисление, в котором выполнение перехода ($\hookrightarrow $) встречается бесконечно часто.



Логика ветвящегося реального времени (Timed CTL; TCTL) — аналог CTL, адаптированный к особенностям поведения СРВ. 

Минимальный синтаксис TCTL-формул над множеством атомарных высказываний AP и множеством часов C задаётся формой Бэкуса-Наура 

$\phi ::= a ~ | ~ (etc) ~ | ~ (\phi \& \phi) ~ | ~ (\neg \phi) ~ | ~ ($**E**$(\phi$ **U** $\phi)) ~ | ~ ($**A**$(\phi$**U**$\phi))$,   где $\phi$ — TCTL-формула, $a \in AP$ и $etc \in ETC(C)$ 

Содержательная трактовка кванторов **E**, **A** и оператора **U** схожа с их трактовкой в CTL но адаптирована к особенностям выполнения СРВ: 

- **E**Φ: существует дивергентное выполнение СРВ, для которого верно Φ 
- **A**Φ: для любого дивергентного выполнения СРВ верно Φ 
- $\phi$**U**$\psi$: в реальном будущем станет верным  $\psi$, а до тех пор будет верно $\phi$  



Рассмотрим временной автомат  $A =(L, l_0,\xi, C, I, T)$ над $AP$, его конфигурацию $\sigma = (l, ν)$ и TCTL-формулу $\phi$ над $C$ и $AP$  

Формула $\phi$ выполняется в конфигурации $\sigma$ автомата $A$ ($A, \sigma \models \phi$) в следующих случаях: 

- $A,\sigma  \models a$  , где $a \in AP$  $\Leftrightarrow$ $a \in \xi(l)$ 

- $A,\sigma \models etc$,   где $etc \in ETC(C)$  $\Leftrightarrow$  $ν \models etc$ 

- $A,\sigma \models \psi \& \chi$   $\Leftrightarrow$  $A,\sigma \models \psi$  и  $A,\sigma \models \chi$ 

- $A,\sigma \models \neg \psi$   $\Leftrightarrow$   $A,\sigma \nvDash \psi$ 

- $A, \sigma \models $ **E**Φ  $\Leftrightarrow$ существует дивергентная $\sigma$-трасса $\tau$ автомата $A$, такая что  $A, \tau \models$ Φ 

- $A, \sigma \models$ **A**Φ  $\Leftrightarrow$  для любой дивергентной $\sigma$-трассы $\tau$ автомата $A$ верно  $A, \tau \models$ Φ 

- $A,\tau \models \psi$**U**$\chi$,   где $\tau =(\sigma_0  \to \sigma_1 \to \sigma_2 \to ...)$ — дивергентная трасса  $\Leftrightarrow$   $A,\sigma_0 \models \chi$  или существуют номер $k, k \ge 1$, и конфигурация $\sigma$, порождаемая на $k$-м шаге трассы $\tau$, такие что   

  - $A,\sigma \models \chi$ и
  -  для всех конфигураций $\delta$, порождаемых трассой $ \sigma_0  \to \sigma_1  \to ... \to \sigma_k \to \sigma$,   верно $A,\delta \models \psi \vee \chi$ 

  

TCTL-формула $\phi$ **выполняется** на автомате $A$ ($A \models \phi$), если она выполняется в начальной конфигурации этого автомата

**Задача model checking для TCTL** Для заданного корректного временного автомата $A$ и заданной TCTL-формулы $\phi$ проверить справедливость соотношения $A \models \phi$ 

**UPPAAL** – это средство верификации систем реального времени.

Структура:

* Модуль описания - входная модель (расширенная модель сети временных автоматов), возможность описания параметризованных шаблонов, наличие данных различной степени локальности

* Модуль симуляции - генерация и визуализация трассы временного автомата

* Модуль верификации - проверка темпоральных свойств, предоставление трассы-контрпримера



> Там, где $\hookrightarrow $  про зеноновские вычисления - это переходы без продвижения по времени 
>
> Примеры придуманы из воздуха (в курсе только примеры с птичками, голодными и не очень)