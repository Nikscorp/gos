# 8. Качество сервиса в компьютерных сетях: модели распределения ресурсов сети и методы борьбы с перегрузками.

**Качество сервиса**

- Нет четкого определения
- Методы позволяющие обслуживать разные потоки данных с разным качеством 
- Методы распределения ресурсов сети между разными потоками данных 
- Методы обеспечения предсказуемого и согласованного поведения сети в условиях постоянно изменяющейся конфигурации 
- Методы повышения эффективности работы и утилизации оборудования сети

**Метрики качества сервиса **

- Уровень потерь (packet loss) – Доля пакетов, которые были отправлены, но не были доставлены получателю [проценты]
- Пропускная способность (bandwidth) – Количество данных, которые могут быть переданы в единицу времени [байты] 
- Задержка (delay) – Время передачи единицы данных по направлению от отправителя к получателю [секунды] 
- Вариация задержки, дрожание (jitter) – Разница между минимальной и максимальной задержками [секунды]

**Что такое управление качеством сервиса? **

- Методы позволяющие обслуживать разные потоки данных с разным качеством 
- Методы распределения ресурсов сети между разными потоками данных 
- Методы обеспечения предсказуемого и согласованного поведения сети в условиях постоянно изменяющейся конфигурации 
- Методы повышения эффективности работы и утилизации оборудования сети



### Перегрузка

**Перегрузка сети** в компьютерных сетях и теории очередей — состояние сети, при котором основные показатели качества обслуживания существенно ухудшаются. Возникает, когда на сетевой узел (например, коммутатор) поступает больше данных, чем он может обрабатывать/передавать. Типичные эффекты включают задержку в очереди, потерю пакетов или блокировку новых соединений. Перегрузки могут возникать как на отдельных участках сети (локальные перегрузки), так и распространяться на всю сеть (глобальные перегрузки).



**Методы борьбы с перегрузкой:**

- Буферизация (не уверена, что это тут нужно)
  - На входе: Нет необходимости в сверх-быстрой памяти. Если пакеты из нескольких входных портов начинают конкурировать за один и тот же вход коммутационной фабрики, возникает блокировка пакетов, находящихся за ними – Head Of Line (HOL) Blocking. При равномерном распределении маршрутов передачи пакетов производительность коммутатора равна менее 59% показателя коммутатора с буферизацией на выходе.
  - На выходе
  - На самом деле на сегодняшний день наиболее распространены модели Combined Input Output Queuing (CIOQ)

- управление перегрузкой



**Управление перегрузкой TCP: задачи** 

- Соединения должны адаптироваться к качеству предоставленной линии связи и стремиться использовать предоставленные ресурсы максимально эффективно 
- Соединения должны автоматически распределять пропускную способность разделяемой ими линии связи справедливым образом

**Управления перегрузкой TCP: принципы работы**

- Взаимодействующие с сетью – Сетевые устройства сигнализируют о возникновении перегрузки (TCP/ECN) 
- Без взаимодействия с коммутаторами – Перегрузка определяется косвенно (по потере пакета, увеличению задержки и т.д.) 
- Реактивные (как правило, loss based) – Детектируют возникновение перегрузок по факту 
- Проактивные (как правило, delay based) – Ограничивают пропускную способность соединения, предчувствуя скорую перегрузку

При отсутствии дополнительных сервисных пакетов отправитель получает информацию из ACK-сообщений, поступающих к нему спустя один Round Trip Time (RTT), следовательно отправитель способен адаптироваться к состоянию сети не быстрее, чем за RTT.

**Примеры**

- TCP Tahoe
  - медленный старт: начинаем с cwnd=1, потом *2, до порога slow-start threshold, ssthresh.
  - предотвращение перегрузки (congestion-avoidance): +1
  - таймаут или 3 dupACK: cwnd=1, медленный старт, ssthresh=ssthresh/2
- TCP Reno
- Cubic
- Data Center TCP
- etc



### Модели распределения ресурсов

**Проблема эффективного распределения ресурсов**

Проблема обеспечения качества связана с проблемой распределения сетевых ресурсов между потоками данных 

- Проблему распределения ресурсов можно формализовать как задачу оптимизации 
- Чем больше ресурсов вовлечено в обслуживание потока, тем выше качество его соединения 
- Чем большее количество ресурсов позволяет задействовать модель распределения, тем выше эффективность сети, и тем больший уровень утилизации достигается. Чем выше уровень утилизации, тем лучше отношение производительности сети к стоимости сетевой инфраструктуры



**Модель Интегрированных Сервисов (IntServ)**

Мультимедийный трафик в сети:

- Как оградить TCP трафик от мультимедийных данных, передающихся через UDP?

- Как обеспечить качество соединения?

- Гарантированный уровень качества можно обеспечить лишь с помощью резервирования ресурсов – закрепления части ресурсов сети за конкретным потоком данных.
  Основная идея – прокладывание маршрутов с заданным качеством путём предварительного
  резервирования ресурсов на оборудовании 

- Модель лишь расширяет архитектуру Интернета, сохраняется совместимость с best-effort

- Модель особенно эффективна при многоадресной передаче данных

- Допускаются накладные расходы на предварительное прокладывание маршрута

- всё или ничего – модель или гарантирует соединение нужного качества, или отказывается
  предоставить какое-либо соединение.

  **Основные компоненты модели IntServ**

- Классификатор (classifier) – Разделение пакетов на классы обслуживания

- Планировщик (scheduler) – Обеспечение выполнения требований QoS

- Контроль доступа (admission control) – Оценка возможности добавления потоков

- Протокол резервирования ресурсов – Резервирование ресурсов вдоль маршрута

**Расчёт и обеспечение качества соединений**

- Распределение по очередям на входящих и исходящих интерфейсах коммутатора 
- Использование policing & shaping для формирования нужного профиля потоков 
- Установка надлежащих дисциплин сброса пакетов при их постановке в очереди и выборки пакетов из очередей 
- Настройка алгоритмов планирования коммутационной матрицы



Пример IntServ протокола: RSVP



**Модель Дифференцированных Сервисов (DiffServ)**

- Каждый маршрутизатор имеет несколько предопределённых классов обслуживания

- Пограничные маршрутизаторы определяют класс потока, маркируют его пакеты dscp метками и проводят traffic conditioning – используют инструменты policing & shaping для установки нужного профиля трафика

- На внутренних маршрутизаторах пакеты с более высоким приоритетом получают большую долю ресурсов, и наоборот

  

  **Стандартные классы обслуживания DiffServ**

- Default Forwarding (DF) – Обычно обслуживается по best-effort

- Expedient Forwarding (EF) – Идёт через очередь с высшим приоритетом, маленькие delay, jitter & loss

- Assured Forwarding (AF) – Идёт через менее приоритетную очередь, охватывает несколько классов с разной политикой сброса при заполнении очереди

- Преимущества

  - Отсутствие внутренней фрагментации
  - Высокая степень утилизации оборудования
  - Простота реализации в аппаратуре
  - Хорошая масштабируемость

- Недостатки
  - Не предоставляет гарантий качества
  - Метрики качества не рассчитываются явно
  - Ограниченное количество классов качества

 